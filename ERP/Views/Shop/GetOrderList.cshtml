@model  List<Model.Orders>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>我的订单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="location" content="province=;city=;coord=" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="apple-touch-icon-precomposed" href="images/screenLogo.png?debug=847" />
    <link rel="stylesheet" type="text/css" href="~/FileCss/css/m2015.css?debug=847b" />
    <script src="~/FileCss/js/zepto.min.js?debug=847" type="text/javascript"></script>
    <script src="~/FileCss/js/main.js?debug=847" type="text/javascript"></script>
    <style>
        body {
            background: #fff;
        }

        .orderlist dl dd.btn a {
            padding: 0 10px;
        }

        .orderlist dl dd.pro .ismobi {
            height: auto;
            position: relative;
            overflow: hidden;
        }

        .imeiinfo {
            margin-left: 70px;
            margin-bottom: 10px;
        }

        .orderlist dl dd.pro .opli .imeiinfo p {
            text-align: left;
            margin-left: 0px;
        }

            .orderlist dl dd.pro .opli .imeiinfo p .c_64b2ff {
                color: #64b2ff;
                display: inline;
                margin-left: 10px;
            }

        .orderlist dl dd.pro .total {
            overflow: hidden;
        }

        .order-search {
            padding: 10px;
            text-align: center;
            background: #fafafa;
            margin-top: 10px;
            box-shadow: inset 0 0 10px #ddd;
        }

            .order-search input[name=order-id] {
                border: 1px solid #e0dddd;
                outline: none;
                height: 28px;
                text-indent: 5px;
                -webkit-appearance: none;
                width: 72%;
                border-radius: 5px;
                background: #fff;
            }

            .order-search input[name=search-btn] {
                border: 0;
                outline: none;
                height: 30px;
                color: #fff;
                background: #f60;
                font-size: 14px;
                border-radius: 5px;
                padding: 0 15px;
                margin-left: 10px;
            }

        .orderlist dl {
            background: #fafafa;
        }
    </style>
</head>
<body>
    <header id="header" style="">
        <div class="topbar">
            <a href="javascript:history.back();" class="back_btn"><i class="iconfont">ş</i></a>
            <a href="javascript:;" class="top_home"><i class="iconfont">ƙ</i></a>
            <h1 class="page_title">我的订单</h1>
        </div>
        <div class="home_menu" id="hMenu">
            <a href="/Shop/Index"><i class="iconfont">Ő</i><span>首页</span></a>
            <a href="/MFlower/ConservationFlowers"><i class="iconfont">Ɔ</i><span>养护花卉</span></a>
            <a href="/MFlower/ChangeFlowers"><i class="iconfont">ŭ</i><span>更换花卉</span></a>
            <a href="/MMIndex/Index"><i class="iconfont">Œ</i><span>会员中心</span></a>
        </div>
    </header>
    <script>
        SiteName = "淘花运";
        var isApp = Cookie.Get("isApp");
        if (isApp == null || isApp == "") { isApp = 0; }
        if (isApp == 1) { $("#header").hide(); }
        $(".top_home").click(function () {
            var target = $(".home_menu");
            if (target.slideToggle) target.slideToggle();
            else target.toggle();
        });
    </script>
    <script type="text/javascript">
        var _mvq = window._mvq || [];
        window._mvq = _mvq;
        _mvq.push(['$setAccount', 'm-23995-6']);

        _mvq.push(['$logConversion']);
        (function () {
            var mvl = document.createElement('script');
            mvl.type = 'text/javascript'; mvl.async = true;
            mvl.src = ('https:' == document.location.protocol ? 'https://static-ssl.mediav.com/mvl.js' : 'http://static.mediav.com/mvl.js');
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(mvl, s);
        })();

    </script>
    <div class="ordercate border_bottom flex">
        <a href="orderlist.aspx" class="cur">全部<i class="border_right"></i></a>
        <a href="orderlist.aspx?type=6">待付款<i class="border_right"></i></a>
        <a href="orderlist.aspx?type=2">待收货<i class="border_right"></i></a>
        <a href="orderlist.aspx?pj=1">待评价</a>
    </div>
    <div class="order-search">
        <input type="text" name="order-id" value="" placeholder="没有找到订单？输入串号可查询！" />
        <input type="button" name="search-btn" value="查  询" onclick="searchOrder()" />
    </div>
    <div id="vOrderList" class="orderlist">
       @foreach (var item in Model)
       {
          <dl id="@item.OrderId">
            <dt class="border_bottom">
                <a href="about.html"><span class="left">订单号：@item.OrderId</span><b class="right" style="">
                   @if (item.OrdersState==1)
                   {
                       @Html.Raw("待支付")
                   }
                   @if (item.OrdersState == 2)
                   {
                         @Html.Raw("待发货")
                   }   
                    @if (item.OrdersState==3)
                    {
                         @Html.Raw("已发货")
                    }   
                    @if (item.OrdersState==4)
                    {
                         @Html.Raw("已签收")
                    }   
                    @if (item.OrdersState==5)
                    {
                        @Html.Raw("取消订单")
                    }                                                   
                    </b></a>
            </dt>
            <dd class="pro">
                <a href="orderDetail.aspx?orderid=4632239">
                    <div class="opli border_bottom  ismobi">

                        <h4><span> </span> <em>&times;1</em></h4>
                        <p>￥3290.00</p>
                    </div>
                    <div class="opli border_bottom  ismobi">
                        <h4><span>iPhone 6s（A1700）国行...</span> <em>&times;1</em></h4>
                        <p>￥4788.00</p>
                    </div>
                    <div class="opli border_bottom ">
                        <h4><span>SANDISK/闪迪 8G TF（M...</span> <em>&times;1</em></h4>
                        <p>￥40.00</p>
                    </div>
                    <div class="opli border_bottom ">
                        <h4><span>小米手环 黑色 </span> <em>&times;1</em></h4>
                        <p>￥79.00</p>
                    </div>
                    <div class="opli border_bottom ">
                        <h4><span>Linkon蓝牙自拍杆兼容苹...</span> <em>&times;1</em></h4>
                        <p>￥40.00</p>
                    </div><p class="total border_bottom">共5件商品，<b>￥8237.00</b>元 </p>
                </a>
            </dd>
            <dd class="btn">
                <a href="/WapAlipay/?sub_id=4632239&amp;payType=1&amp;price=8237.00">去付款</a>
            </dd>
        </dl>
       }
    </div>
    <script>
        function cancelOrder(orderid, type) {
            layer.open({
                content: "您确定要取消订单吗？取消后该订单将被删除！",
                btn: ['确认', '取消'],
                shadeClose: false,
                yes: function () {
                    $.get("orderlist.aspx?act=cancelorder&orderid=" + orderid + "&type=" + type, function (re) {
                        if (re.stats == 1) {
                            layer.open({
                                content: "取消成功！",
                                shadeClose: false,
                                btn: ['OK'],
                            });
                            $('#order_' + orderid).remove();
                        } else {
                            layer.open({
                                content: re.msg,
                                shadeClose: false,
                                btn: ['OK'],
                            })
                        }
                    }, "json")
                }
            });
        }
        function loadNexPage(page, pagerbar, type, pj) {
            $(pagerbar).html('加载中，请稍后...');
            $.post("?act=loadorder&p=" + page, { type: type, pj: pj }, function (re) {
                $(pagerbar).remove();
                if (page == 1) { document.body.scrollTop = 0; }
                else { $('#vOrderList').append(re); loadServer(); }
            })
        }

        $(function () {
            loadServer();
        });
        function loadServer() {
            $('.imeiinfo').each(function (index, element) {
                var el = $(element);
                if (el.attr('imei') != null && el.attr('imei') != '') {
                    $.get('/ajax/ajaxOperate.aspx?act=getrecord&imei=' + el.attr('imei'), function (re) {
                        if (re.stats == 1) {
                            el.show();
                            var reg = /^(.*?)\s(.*)$/;
                            var fwstr = '<p>保修有效期：<span>' + re.tradedate.replace(/\s.*/, '') + '～' + re.BaoxiuEndDate.replace(/\s.*/, '') + (re.isbaoxiu == 1 ? ' (在保修期内)' : '') + '</span></p>';
                            if (re.isbaoxiu == 0) { fwstr += '<p>保修状态：<span class="c_red">已过期，您的产品已过一年保修服务！</span></p>'; }
                            if (re.YiwaiStartDate != undefined && re.YiwaiStartDate != "") {
                                fwstr += "<p>三九服务日期：<span>" + re.YiwaiStartDate.replace(reg, "$1") + "~" + re.YiwaiEndDate.replace(reg, "$1") + "</span></p>";
                            } else {
                                fwstr += "<p>三九服务：<span>未购买 <a href='/fuwu/fuwu.aspx' class='c_64b2ff' target='_blank'>什么是三九服务？</span></p>";
                            }
                            el.attr("imei", "");
                            el.append(fwstr);
                        }
                    }, 'json')
                }
            });
        }
        /*输入串号查询订单*/
        function searchOrder() {
            var CH = $.trim($("input[name=order-id]").val());
            if (CH == "") {
                layer.open({
                    content: '输入IMEI码错误,请核对！',
                    shadeClose: false,
                    btn: ['确定']
                });
                return;
            }
            $.get("?act=getOrderByIMEI", { IMEI: CH }, function (re) {
                $('#vOrderList').html(re); loadServer();
            }, "text");//数据在后台绘制
        }
    </script>
</body>
</html>