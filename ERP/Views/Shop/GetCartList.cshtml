@model  Model.CartLine

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>我的购物车</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />  
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />     
    <meta name="location" content="province=;city=;coord=" />
    
    <script src="~/FileCss/js/jquery.min.js"></script>
   
    <script src="~/FileCss/js/main.js?debug=847" type="text/javascript"></script>
 
    <script src="~/Thems/js/layer/mobile/layer.js"></script>
    <link href="~/FileCss/css/shopitem.css" rel="stylesheet" />
    @*加载表格*@
    @Scripts.Render("~/plugins/jQuery/jquery-2.2.3.min.js")
    @Styles.Render("~/Bootstrap/css/bootstrap.min.css")
    @Scripts.Render("~/Bootstrap/js/bootstrap.min.js")
    <script src="~/Bootstrap/js/jquery.bootstrap-touchspin.min.js"></script>
    <link href="~/FileCss/css/header.css" rel="stylesheet" />
    <link href="~/Bootstrap/css/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
    <style>
        body {
            background: #fff;
        }
        .text-center {
        text-align: left;font-size: 15px;font-weight: bold;color: red;
        line-height:12px;
        }
    </style>
    <script>
        $(function () {
           //
            $(".btn-sm").click(function () {
                //$(this).closest("div.productbox").find('#Id').val()
                var id = $(this).closest("div.productbox").find('#Id').val();
                
                layer.open({
                    content: '您确定将此商品移出购物车吗？'
                 , btn: ['取消', '确定']
                 , no: function (index) {
                     var num = 1;
                     $.ajax({
                         url: '/BuyCart/RemoveFromCart?id=' + id,
                         type: "get",
                         dataType: "json",
                         success: function (data, status) {
                             if (data.code == 1) {
                                 location.reload();
                             }
                         },
                     })//提示
                     layer.open({
                         content: '移出购物车成功!'
                      , skin: 'msg'
                      , time: 2 //2秒后自动关闭
                     });
                 }, yes: function (index) {
                     layer.close(index);
                 }
                });

            });
            //
        var i = $("input[class='demo2']");
        i.TouchSpin({
            min: 1,
            max: 100,
            step: 1//增量或减量
        });

        i.on("touchspin.on.stopupspin", function () {
            $.post('@Url.Action("IncreaseOrDecreaseOne", "BuyCart")', { "id": $(this).closest("div.productbox").find('#Id').val(), "quantity": $(this).val() }, function (data) {
                if (data.msg) {
                    location.reload();
                }
            });

            //var temp = $(this).val();
            //alert(temp);


            //var temp = $(this).closest("div.productbox").find('#Id').val();
            //alert(temp);
        });

        i.on("touchspin.on.stopdownspin", function () {
            $.post('@Url.Action("IncreaseOrDecreaseOne", "BuyCart")', { "id": $(this).closest("div.productbox").find('#Id').val(), "quantity": $(this).val() }, function (data) {
                if (data.msg) {
                    location.reload();
                }
            });
        });
    })

    function SetOrdersState(OrdersId) {
        parent.layer.open({
            type: 2,
            title: '修改状态',
            shadeClose: true,
            shade: 0.8,
            area: ['300px;', '200px;'],
            content: '/Orders/SetOrderState?OrdersId=' + OrdersId,
            end: function () { //层彻底关闭后执行的回调
                onloadTable();
            }
        });
    }

    function RemoveF(OrdersId) {
        location.href = '/Orders/OrdersInfoMation?OrdersId=' + OrdersId;
    }
          
    </script>

</head>
<body>   
    @Html.Partial("header")   
    <div class="container">
        <div class="row">
            @for (int i = 0; i < Model.Products.Count; i++)
            {
                var item = (Model.Products)[i];


                if (i != 0 && i % 4 == 0) //每行有4个div
                {
                    <div style="clear:both;"></div>
                }

                <div class="col-md-3 column productbox">
                    @Html.Hidden("Id", item.Id)                    
                    <img src="@item.FlowerWatchPhoto" style="width: 460px; height: 250px;" class="img-responsive">
                    <div class="producttitle">
                        <div class="productname">@item.FlowerWatchName</div>
                        <div class="productdes">@item.FlowerIntroduction</div>
                        <div>
                            <table>
                                <tr>
                                    <td style="width:50px;">单价：</td>
                                    <td>@item.FlowerSalesPrice</td>
                                </tr>
                                <tr>
                                    <td>数量：</td>
                                    <td>
                                        <input class="demo2" type="text" value="@item.Num" name="demo2" />
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" class="checkbox" fid="@item.Id" /></td>
                                    <td>小计：</td>
                                    <td>@((item.Num * item.FlowerSalesPrice).ToString("c"))</td>
                                    <td><input class="btn btn-default btn-sm" type="button" value="移除" />  
                                     </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="productprice">
                        <div class="text-center">    
                        </div>
                    </div>
                </div>
            }

        </div>
    </div>
    <hr />
    <div class="container">        
        <div class="btn_box border_top">
            <div class="text-center">
                <input type="checkbox" class="allcheck" allfid="" />
                <span>总计：</span> @Model.Products.Sum(x => x.Num * x.FlowerSalesPrice).ToString("c")
            </div>
            <div class="">             
                <a href="javascript:void(0)" data-src="" onclick="SubmitIinfo()" class="cart right">结算</a>
            </div>

        </div>
    </div>
    
    
</body>
</html>